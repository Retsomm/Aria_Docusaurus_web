---
title: Redux Toolkit (RTK) 介紹與應用
description: ""
keywords:
  [Redux, Redux Toolkit, RTK, 狀態管理]
---


## 什麼是 Redux Toolkit？

Redux Toolkit (RTK) 是 Redux 的官方推薦工具集，旨在簡化 Redux 的使用。它提供了更簡潔的 API、更少的樣板程式碼，並且包含了最佳實踐的預設配置。

### RTK 的主要特點

1. **簡化 Store 配置**：使用 `configureStore` 自動設置 Redux DevTools、中間件等
2. **Slice 模式**：使用 `createSlice` 將相關的 state、actions 和 reducers 組織在一起
3. **內建 Immer**：自動處理不可變狀態更新
4. **TypeScript 支援**：完整的類型安全
5. **最佳實踐**：包含 Redux 社群的最佳實踐


### 1. Store 配置 (`store/index.ts`)

```typescript
import { configureStore } from '@reduxjs/toolkit';
import websocketMiddleware from './websocketMiddleware';
import orderReducer from './slices/orderSlice';
import locationReducer from './slices/locationSlice';
import websocketReducer from './slices/websocketSlice';

export const store = configureStore({
  reducer: {
    orders: orderReducer,
    locations: locationReducer,
    websocket: websocketReducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['websocket/connect', 'websocket/disconnect'],
      },
    }).concat(websocketMiddleware),
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

**應用說明**：
- 使用 `configureStore` 簡化 store 配置
- 整合自定義 WebSocket 中間件
- 配置序列化檢查以忽略 WebSocket actions
- 導出類型以支援 TypeScript

### 2. Slice 實現

#### Order Slice (`slices/orderSlice.ts`)

```typescript
import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { OrderStatus } from '../../types';

interface OrderState {
  orders: { [orderId: string]: OrderStatus };
  loading: boolean;
}

const orderSlice = createSlice({
  name: 'orders',
  initialState,
  reducers: {
    updateOrder: (state, action: PayloadAction<OrderStatus>) => {
      state.orders[action.payload.orderId] = action.payload;
    },
    setLoading: (state, action: PayloadAction<boolean>) => {
      state.loading = action.payload;
    },
  },
});

export const { updateOrder, setLoading } = orderSlice.actions;
export default orderSlice.reducer;
```

**應用說明**：
- 使用 `createSlice` 定義訂單狀態管理
- 自動生成 action creators 和 reducer
- 處理訂單狀態更新和載入狀態

#### Location Slice (`slices/locationSlice.ts`)

```typescript
const locationSlice = createSlice({
  name: 'locations',
  initialState,
  reducers: {
    updateLocation: (state, action: PayloadAction<DriverLocation>) => {
      state.locations[action.payload.driverId] = action.payload;
    },
    setTrackingOrderId: (state, action: PayloadAction<string | null>) => {
      state.trackingOrderId = action.payload;
    },
    clearLocations: (state) => {
      state.locations = {};
    },
  },
});
```

**應用說明**：
- 管理司機位置數據
- 支援訂單追蹤功能
- 提供清除位置數據的功能

#### WebSocket Slice (`slices/websocketSlice.ts`)

```typescript
const websocketSlice = createSlice({
  name: 'websocket',
  initialState,
  reducers: {
    setConnectionStatus: (state, action: PayloadAction<ConnectionStatus>) => {
      state.connectionStatus = action.payload;
    },
    setAuthenticated: (state, action: PayloadAction<boolean>) => {
      state.isAuthenticated = action.payload;
    },
    setLastMessage: (state, action: PayloadAction<string | null>) => {
      state.lastMessage = action.payload;
    },
  },
});
```

**應用說明**：
- 管理 WebSocket 連接狀態
- 追蹤驗證狀態
- 記錄最後收到的訊息

### 3. 自定義中間件 (`websocketMiddleware.ts`)

```typescript
export const websocketMiddleware: Middleware = (store) => (next) => (action) => {
  switch (action.type) {
    case 'websocket/connect':
      // 處理 WebSocket 連接邏輯
      break;
    case 'websocket/subscribe':
      // 處理頻道訂閱邏輯
      break;
    // ... 其他 cases
  }
  return next(action);
};
```

**應用說明**：
- 攔截 WebSocket 相關 actions
- 管理 WebSocket 連接和訂閱
- 自動分發接收到的數據到對應的 slices

## RTK 的優勢

### 1. 減少樣板程式碼
- 傳統 Redux 需要手動編寫 action types、action creators 和 reducers
- RTK 的 `createSlice` 自動生成這些程式碼

### 2. 內建 Immer
```typescript
// RTK 允許直接修改 state（實際上是安全的）
state.orders[action.payload.orderId] = action.payload;

// 傳統 Redux 需要
return {
  ...state,
  orders: {
    ...state.orders,
    [action.payload.orderId]: action.payload
  }
};
```

### 3. 自動類型推斷
- RTK 與 TypeScript 完美整合
- 自動推斷 action payload 的類型

### 4. 最佳實踐預設
- 自動啟用 Redux DevTools
- 預設包含常用的中間件
- 序列化檢查防止意外的非序列化數據

## 在 React 組件中的使用

```typescript
import { useSelector, useDispatch } from 'react-redux';
import { updateOrder } from '../store/slices/orderSlice';
import type { RootState, AppDispatch } from '../store';

function OrderComponent() {
  const dispatch = useDispatch<AppDispatch>();
  const orders = useSelector((state: RootState) => state.orders.orders);

  const handleUpdateOrder = (orderData: OrderStatus) => {
    dispatch(updateOrder(orderData));
  };

  return (
    // 組件實現
  );
}
```

## 總結

Redux Toolkit 大大簡化了 Redux 的使用，讓開發者能夠專注於業務邏輯而不是樣板程式碼。本專案展示了 RTK 在實際應用中的各種用法，包括：

- 基本的狀態管理
- 自定義中間件的整合
- WebSocket 實時數據處理
- TypeScript 類型安全

RTK 是現代 React 應用中狀態管理的首選工具之一。