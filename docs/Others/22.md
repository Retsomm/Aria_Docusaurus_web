---
title: AbortControllerä»‹ç´¹
description: ''
keywords: [JavaScript, AbortController, WebAPI]
---

## ä¸€ã€ä»€éº¼æ˜¯ AbortControllerï¼Ÿ

`AbortController` æ˜¯ç€è¦½å™¨å…§å»ºçš„ä¸€å€‹ APIï¼Œç”¨ä¾† **æ§åˆ¶å–æ¶ˆæ“ä½œ**ã€‚\
æœ€å¸¸è¦‹çš„ç”¨é€”å°±æ˜¯æ­é… `fetch`ï¼Œç•¶ä½ ç™¼é€ç¶²è·¯è«‹æ±‚å¾Œï¼Œå¦‚æœåœ¨æŸäº›æƒ…æ³ä¸‹ä¸éœ€è¦å›æ‡‰ï¼ˆä¾‹å¦‚ï¼šä½¿ç”¨è€…è·³é ã€æœå°‹æ¡†è¼¸å…¥æ–°é—œéµå­—ç­‰ï¼‰ï¼Œå°±å¯ä»¥ç”¨å®ƒä¾†ã€Œä¸­æ­¢ã€è«‹æ±‚ï¼Œé¿å…æµªè²»ç¶²è·¯è³‡æºæˆ–ç”¢ç”Ÿä¸å¿…è¦çš„çµæœã€‚

---

## äºŒã€AbortController çš„çµ„æˆ

- **AbortController**\
   é€™æ˜¯ä¸€å€‹ã€Œæ§åˆ¶å™¨ã€ï¼Œå¯ä»¥å»ºç«‹ã€Œä¿¡è™Ÿï¼ˆsignalï¼‰ã€ä¸¦è² è²¬è§¸ç™¼å–æ¶ˆäº‹ä»¶ã€‚

- **AbortSignal**\
   é€™æ˜¯ã€Œä¿¡è™Ÿç‰©ä»¶ã€ï¼Œä»£è¡¨æŸå€‹æ“ä½œæ˜¯å¦è¢«ä¸­æ­¢ã€‚ç•¶ä½ å‘¼å« `controller.abort()`ï¼Œé€™å€‹ signal å°±æœƒé€šçŸ¥å°æ‡‰çš„æ“ä½œè¦çµæŸã€‚

```javascript
const controller = new AbortController();
const signal = controller.signal;
```

---

## ä¸‰ã€åŸºæœ¬ä½¿ç”¨ç¯„ä¾‹

### 1\. æ­é… fetch

```javascript
const controller = new AbortController();
const signal = controller.signal;

fetch("https://jsonplaceholder.typicode.com/posts", { signal })
  .then(response => response.json())
  .then(data => console.log("æˆåŠŸå›æ‡‰ï¼š", data))
  .catch(err => {
    if (err.name === "AbortError") {
      console.log("è«‹æ±‚å·²è¢«ä¸­æ­¢");
    } else {
      console.error("å…¶ä»–éŒ¯èª¤ï¼š", err);
    }
  });

// åœ¨ 1 ç§’å¾Œä¸­æ­¢è«‹æ±‚
setTimeout(() => {
  controller.abort();
}, 1000);
```

ğŸ‘‰ èªªæ˜ï¼š

1. å»ºç«‹ `AbortController`ï¼Œä¸¦æŠŠ `signal` å‚³çµ¦ `fetch`ã€‚

2. å¦‚æœ `controller.abort()` è¢«å‘¼å«ï¼Œ`fetch` å°±æœƒä¸Ÿå‡ºä¸€å€‹ `AbortError`ã€‚

3. é€™æ¨£å°±å¯ä»¥åœ¨ç‰¹å®šæƒ…æ³ä¸‹çµæŸè«‹æ±‚ï¼Œé¿å…ç¹¼çºŒæ¶ˆè€—è³‡æºã€‚

---

### 2\. æ­é…äº‹ä»¶ç›£è½å™¨

`AbortController` ä¸åªå¯ä»¥ç”¨åœ¨ `fetch`ï¼Œä¹Ÿèƒ½ç”¨åœ¨æ”¯æ´ **AbortSignal** çš„ APIï¼Œä¾‹å¦‚äº‹ä»¶ç›£è½å™¨ã€‚

```javascript
const controller = new AbortController();
const signal = controller.signal;

document.addEventListener("click", () => {
  console.log("æ–‡ä»¶è¢«é»æ“Šï¼");
}, { signal });

// ä¸­æ­¢å¾Œäº‹ä»¶ç›£è½å™¨æœƒè‡ªå‹•ç§»é™¤
setTimeout(() => {
  controller.abort();
  console.log("é»æ“Šäº‹ä»¶ç›£è½å™¨å·²è¢«ç§»é™¤");
}, 3000);
```

---

## å››ã€å¸¸è¦‹ä½¿ç”¨æƒ…å¢ƒ

1. **æœå°‹æ¡†å³æ™‚æŸ¥è©¢**\
   ä½¿ç”¨è€…è¼¸å…¥æ–°é—œéµå­—æ™‚ï¼Œå–æ¶ˆèˆŠçš„ API è«‹æ±‚ï¼Œé¿å…å¤šé¤˜çš„çµæœå›ä¾†ã€‚

2. **é é¢è·³è½‰**\
   å¦‚æœä½¿ç”¨è€…é›¢é–‹ç•¶å‰é é¢ï¼Œä¸éœ€è¦å†ç­‰å¾… API å›æ‡‰ï¼Œç›´æ¥ä¸­æ­¢è«‹æ±‚ã€‚

3. **å¤šé‡äº‹ä»¶ç›£è½ç®¡ç†**\
   åˆ©ç”¨ `AbortSignal` å¯ä»¥æ›´ä¹¾æ·¨åœ°ç®¡ç†ç›£è½å™¨ï¼Œè€Œä¸ç”¨è‡ªå·±æ‰‹å‹•å‘¼å« `removeEventListener`ã€‚

---

## äº”ã€ç¸½çµ

- `AbortController` æä¾› **ä¸­æ­¢æ“ä½œ** çš„èƒ½åŠ›ã€‚

- `controller.signal` è¦å‚³çµ¦æ”¯æ´çš„ APIï¼ˆä¾‹å¦‚ `fetch` æˆ–äº‹ä»¶ç›£è½å™¨ï¼‰ã€‚

- å‘¼å« `controller.abort()` å°±æœƒé€šçŸ¥ç›¸é—œæ“ä½œä¸­æ­¢ã€‚

- å¸¸è¦‹æ–¼ **å–æ¶ˆè«‹æ±‚**ã€**æ¸…é™¤äº‹ä»¶ç›£è½å™¨**ï¼Œè®“ç¨‹å¼æ›´æœ‰æ•ˆç‡ã€æ›´ä¹¾æ·¨ã€‚

## React Hooks ç¯„ä¾‹ï¼šæœå°‹æ¡†è‡ªå‹•å–æ¶ˆå‰ä¸€æ¬¡çš„ fetch

```jsx
import React, { useState, useEffect } from "react";

export default function SearchBox() {
  const [query, setQuery] = useState("");         // ä½¿ç”¨è€…è¼¸å…¥çš„é—œéµå­—
  const [results, setResults] = useState([]);     // API å›å‚³çš„çµæœ
  const [loading, setLoading] = useState(false);  // æ˜¯å¦æ­£åœ¨è¼‰å…¥ä¸­
  const [error, setError] = useState(null);       // éŒ¯èª¤è¨Šæ¯

  useEffect(() => {
    if (!query) {
      setResults([]);
      return;
    }

    const controller = new AbortController(); // å»ºç«‹æ§åˆ¶å™¨
    const signal = controller.signal;

    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);

        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts?q=${query}`,
          { signal }
        );

        if (!response.ok) {
          throw new Error("ç¶²è·¯å›æ‡‰å¤±æ•—");
        }

        const data = await response.json();
        setResults(data); // æ›´æ–°çµæœï¼ˆimmutable æ›´æ–°ï¼‰
      } catch (err) {
        if (err.name === "AbortError") {
          console.log("å‰ä¸€æ¬¡çš„è«‹æ±‚å·²è¢«ä¸­æ­¢");
        } else {
          setError(err.message);
        }
      } finally {
        setLoading(false);
      }
    };

    fetchData();

    // cleanupï¼šåœ¨ effect è¢«ä¸‹ä¸€æ¬¡è§¸ç™¼æ™‚ï¼Œä¸­æ­¢å‰ä¸€æ¬¡è«‹æ±‚
    return () => {
      controller.abort();
    };
  }, [query]); // query æ”¹è®Šæ™‚æ‰æœƒè§¸ç™¼æ–°çš„ fetch

  return (
    <div style={{ padding: "20px" }}>
      <h2>æœå°‹æ–‡ç« </h2>
      <input
        type="text"
        placeholder="è¼¸å…¥é—œéµå­—..."
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        style={{ width: "300px", padding: "8px", fontSize: "16px" }}
      />
      {loading && <p>è¼‰å…¥ä¸­...</p>}
      {error && <p style={{ color: "red" }}>éŒ¯èª¤ï¼š{error}</p>}
      <ul>
        {results.map((item) => (
          <li key={item.id}>{item.title}</li>
        ))}
      </ul>
    </div>
  );
}

```

---

## ç¨‹å¼é‡é»è§£æ

1. **æ¯æ¬¡è¼¸å…¥ `query` æ”¹è®Šæ™‚ï¼ŒuseEffect éƒ½æœƒé‡æ–°è§¸ç™¼** â†’ é–‹å§‹ä¸€å€‹æ–°çš„ `fetch`ã€‚

2. **cleanup æ©Ÿåˆ¶ (`return () => controller.abort()`)** â†’ ä¿è­‰èˆŠçš„è«‹æ±‚æœƒè¢«å–æ¶ˆã€‚

3. **éŒ¯èª¤åˆ¤æ–·** â†’ åªæœ‰ `AbortError` æ‰å¿½ç•¥ï¼Œå…¶ä»–éŒ¯èª¤è¦é¡¯ç¤ºçµ¦ä½¿ç”¨è€…ã€‚

4. **immutable æ›´æ–°** â†’ `setResults(data)` ç›´æ¥å»ºç«‹æ–°çš„é™£åˆ—ï¼Œé¿å…ä¿®æ”¹èˆŠçš„ stateã€‚

5. **ç‹€æ…‹åˆ‡åˆ†** â†’ `loading`ã€`error`ã€`results` éƒ½åˆ†é–‹ stateï¼Œè®“ UI ä¹¾æ·¨ã€‚